<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Javier Sánchez Monedero">

<title>Programación y Administración de Sistemas (2022-2023) – presentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      Programación y Administración de Sistemas (2022-2023)
      </li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Buscar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../../">Programación y Administración de Sistemas (2022-2023)</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Inicio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tema00-presentacion/presentacion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tema 0: Presentación</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tema01-introduccion/tema01-introduccion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tema 1: Introducción</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tema01-introduccion/tema01-software-libre.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tema 1: Software Libre y Linux</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tema02-organizacion/tema02-ficheros.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tema 2: Organización de GNU/Linux</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tema02-organizacion/tema02-ejercicios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tema 2: Ejercicios permisos</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tema02-organizacion/tema02-webuco.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tema 2: Ejercicios web personal en la UCO</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tema03-arranque/tema03-arranque.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tema 3: Arranque y Parada</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tema04-usuarios/tema04-usuarios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tema 4: Gestión de usuarios</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tema05-recursos/tema05-recursos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tema 5: Gestión de recursos</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tema06-sf/tema06-sf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tema 6: Sistemas de ficheros y discos</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../enlaces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Enlaces</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">En esta página</h2>
   
  <ul>
  <li><a href="#objetivos" id="toc-objetivos" class="nav-link active" data-scroll-target="#objetivos"><span class="header-section-number">1</span> Objetivos</a></li>
  <li><a href="#introducción" id="toc-introducción" class="nav-link" data-scroll-target="#introducción"><span class="header-section-number">2</span> Introducción</a></li>
  <li><a href="#servidor-de-archivos" id="toc-servidor-de-archivos" class="nav-link" data-scroll-target="#servidor-de-archivos"><span class="header-section-number">3</span> Servidor de archivos</a></li>
  <li><a href="#asignación-de-bloques" id="toc-asignación-de-bloques" class="nav-link" data-scroll-target="#asignación-de-bloques"><span class="header-section-number">4</span> Asignación de bloques</a></li>
  <li><a href="#gestión-del-espacio-libre" id="toc-gestión-del-espacio-libre" class="nav-link" data-scroll-target="#gestión-del-espacio-libre"><span class="header-section-number">5</span> Gestión del espacio libre</a></li>
  <li><a href="#incremento-de-prestaciones" id="toc-incremento-de-prestaciones" class="nav-link" data-scroll-target="#incremento-de-prestaciones"><span class="header-section-number">6</span> Incremento de prestaciones</a></li>
  <li><a href="#referencias" id="toc-referencias" class="nav-link" data-scroll-target="#referencias"><span class="header-section-number">7</span> Referencias</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="objetivos" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Objetivos</h1>
</section>
<section id="introducción" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Introducción</h1>
<section id="introducción-1" class="level3">
<h3 class="anchored" data-anchor-id="introducción-1">Introducción</h3>
<ul>
<li><p>La función principal de un disco duro es almacenar la información del PC cuando no se encuentra conectado a la corriente eléctrica.</p></li>
<li><p>También puede servir de extensión para la memoria RAM, gracias al mecanismo de <strong>memoria virtual</strong> (<span class="alert">intercambio</span>).</p></li>
<li><p>En la actualidad, existen dos tecnologías que conviven en los discos duros: la de los <span class="alert">SSD</span> y la de los <span class="alert">discos rígidos</span>.</p></li>
<li><p>Los discos rígidos funcionan de forma parecida a un tocadiscos, mientras que los discos SSD (<em>Solid State Disk</em> o, mejor, <em>Solid State Drive</em>) utilizan una memoria formada por semiconductores para almacenar la información (similar a <em>pendrives</em> o tarjetas de memoria).</p></li>
</ul>
</section>
<section id="discos-rígidos" class="level3">
<h3 class="anchored" data-anchor-id="discos-rígidos">Discos rígidos</h3>
<p><img src="images/hd.png" class="img-fluid" style="width:48.0%" alt="image"> <img src="images/hdOrg.jpg" class="img-fluid" style="width:50.0%" alt="image"></p>
</section>
<section id="discos-rígidos-1" class="level3">
<h3 class="anchored" data-anchor-id="discos-rígidos-1">Discos rígidos</h3>
<ul>
<li><p>¿De qué esta compuesto un <span class="alert">disco duro rígido</span>?</p>
<ul>
<li><p><strong>Plato</strong>: Cada uno de los discos que se encuentran apilados en su interior, cubiertos de un material magnetizable (de aluminio o cristal). La escritura cambia el estado de este material.</p></li>
<li><p><strong>Cabezal</strong>: es un brazo que se mueve sobre el plato. Como los discos giran, permite acceder a cualquier punto de los mismos.</p></li>
<li><p><strong>Pista</strong>: Se trata de cada una de las líneas esféricas que se pueden formar sobre cada plato.</p></li>
<li><p><strong>Cilindro</strong>: Conjunto de varias pistas que se encuentran una encima de otra.</p></li>
<li><p><strong>Sector</strong>: Cada una de las divisiones que se hace de la circunferencia que se forma en el disco. Normalmente en un sólo sector tendremos varios cientos de <em>bytes</em> de información.</p></li>
</ul></li>
<li><p>Indicando el cilindro, la cabeza y el sector podemos acceder a cualquier dato del disco.</p></li>
</ul>
</section>
<section id="discos-rígidos-escritura" class="level3">
<h3 class="anchored" data-anchor-id="discos-rígidos-escritura">Discos rígidos: escritura</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/magnetico.png" style="height:50.0%" class="figure-img"></p>
<p></p><figcaption class="figure-caption">image</figcaption><p></p>
</figure>
</div>
</section>
<section id="archivos" class="level3">
<h3 class="anchored" data-anchor-id="archivos">Archivos</h3>
<ul>
<li><p><strong>Archivo</strong>: unidad de almacenamiento lógico no volátil que agrupa un conjunto de información relacionada entre si bajo un mismo nombre.</p>
<ul>
<li><p>Un archivo debe poseer un nombre que permita acceder al mismo de forma unívoca.</p></li>
<li><p>Este nombre incluye una extensión (<code>.txt</code>, <code>.zip</code>...) que identifica el tipo de archivo.</p></li>
<li><p>El acceso a un archivo puede ser <strong>secuencial</strong> (para acceder a una posición hay que acceder antes a las anteriores) o <strong>directo/aleatorio</strong> (se puede acceder a cualquier posición).</p></li>
</ul></li>
</ul>
</section>
<section id="sistema-de-archivos" class="level3">
<h3 class="anchored" data-anchor-id="sistema-de-archivos">Sistema de Archivos</h3>
<div class="block">
<p>Sistema de Archivos/Ficheros (SA/SF)</p>
<ul>
<li><p>Organiza la información de los dispositivos de almacenamiento secundario (disco duro, disco extraíble, DVDs, CDRom...).</p></li>
<li><p>El dispositivo se divide manera lógica para que quede organizado de una forma inteligible para el SO.</p></li>
<li><p>La división se hace a múltiples niveles:</p>
<ul>
<li><p><strong>Particiones</strong> o <strong>volúmenes</strong>.</p></li>
<li><p><strong>Bloques</strong>.</p></li>
<li><p><strong>Agrupaciones</strong>.</p></li>
</ul></li>
</ul>
</div>
</section>
<section id="sistema-de-archivos-1" class="level3">
<h3 class="anchored" data-anchor-id="sistema-de-archivos-1">Sistema de Archivos</h3>
<ul>
<li><p><strong>Partición</strong>: porción de un disco a la que se le dota de una identidad propia y que se manipula como un entidad lógica independiente.</p>
<ul>
<li>Las particiones deben <strong>formatearse</strong> para que se creen las estructuras necesarias que permiten al SO manipular el disco.</li>
</ul></li>
<li><p><strong>Bloque</strong>: agrupación lógica de sectores físicos del disco, la cual supone la unidad de transferencia mínima que usa el SA.</p>
<ul>
<li><p>El tamaño de bloque es un parámetro decisivo que afecta a la eficiencia del acceso a disco y a la fragmentación del mismo.</p>
<ul>
<li><p>Tamaño de bloque <span class="alert">pequeño</span>: Mayor número de operaciones de Entrada/Salida (E/S) para acceder al archivo. Menor fragmentación.</p></li>
<li><p>Tamaño de bloque <span class="alert">grande</span>: Menor número de operaciones E/S para acceder al archivo. Mayor fragmentación.</p></li>
</ul></li>
</ul></li>
<li><p><strong>Agrupación</strong>: conjunto de bloques gestionado como una unidad lógica de almacenamiento.</p></li>
</ul>
</section>
<section id="estructura-del-sistema-de-archivos" class="level3">
<h3 class="anchored" data-anchor-id="estructura-del-sistema-de-archivos">Estructura del Sistema de Archivos</h3>
<div class="center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/estructura.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="estructura-del-sistema-de-archivos-1" class="level3">
<h3 class="anchored" data-anchor-id="estructura-del-sistema-de-archivos-1">Estructura del Sistema de Archivos</h3>
<ul>
<li><p>El bloque de carga (<strong><em>boot</em></strong> o <em>Volume Boot Record</em>) contiene código ejecutado al arrancar el ordenador por el iniciador ROM utilizando esa partición.</p>
<ul>
<li><p>El MBR apunta al VBR de la partición activa<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p></li>
<li><p>Se suele incluir en todas las particiones (aunque no contengan el SO) para así mantener una estructura uniforme.</p></li>
<li><p>Se añade un <strong>número mágico</strong>, el cuál será comprobado por el iniciador ROM para demostrar que el bloque de carga es válido.</p></li>
</ul></li>
<li><p><strong>Metainformación</strong>: super-bloques, FAT, nodos-i, mapas de bits, descriptores físicos...</p>
<ul>
<li><p>Describe el SA y la distribución de sus componentes.</p></li>
<li><p>Es necesaria para poder acceder a los datos.</p></li>
</ul></li>
</ul>
</section>
<section id="estructura-del-sistema-de-archivos-2" class="level3">
<h3 class="anchored" data-anchor-id="estructura-del-sistema-de-archivos-2">Estructura del Sistema de Archivos</h3>
<ul>
<li><p><strong>Superbloque</strong>: características del SA, posición de los distintos elementos, tamaño...</p>
<ul>
<li><p>Se mantiene una serie de información común para todos los SAs y una entrada característica para cada tipo de SA.</p></li>
<li><p>Al arrancar la máquina, los superbloques de todos los SAs que son cargados se mantienen en memoria.</p></li>
</ul></li>
<li><p><strong>Descriptores físicos de archivos</strong>: nodos-i, registros de Windows-NT...</p>
<ul>
<li><p>Describen cada uno de los archivos almacenados.</p></li>
<li><p>Tienen una estructura y tamaño muy dependiente del SO.</p></li>
<li><p>El número de descriptores debe ser proporcional al tamaño total del disco.</p></li>
<li><p>Incluyen: tamaño, apuntadores a los bloques del archivo, permisos, propietarios...</p></li>
</ul></li>
</ul>
</section>
<section id="estructura-del-sistema-de-archivos-3" class="level3">
<h3 class="anchored" data-anchor-id="estructura-del-sistema-de-archivos-3">Estructura del Sistema de Archivos</h3>
<ul>
<li><p><strong>Gestión del espacio libre</strong>: distintos mecanismos permiten gestionar el espacio libre.</p>
<ul>
<li><p>Se pueden utilizar <strong>mapas de bits</strong> o <strong>listas de recursos libres</strong>.</p></li>
<li><p>Gestión de dos tipos de recursos:</p>
<ul>
<li><p>Mapas de <span class="alert">bloques</span>: indican qué bloques (o agrupaciones) están libres.</p></li>
<li><p>Mapas de <span class="alert">descriptores de archivos</span>: indican qué descriptores de archivos (nodos-i, registros...) están libres.</p></li>
</ul></li>
</ul></li>
<li><p><strong>Bloques de datos</strong>: es dónde se almacena realmente la información.</p></li>
</ul>
</section>
</section>
<section id="servidor-de-archivos" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Servidor de archivos</h1>
<section id="servidor-de-archivos-1" class="level3">
<h3 class="anchored" data-anchor-id="servidor-de-archivos-1">Servidor de Archivos</h3>
<ul>
<li><p><strong>Servidor de Archivos</strong>: es el componente del SO que se encargará de gestionar el acceso a archivos.</p></li>
<li><p>Se sigue una filosofía de organización en capas.</p>
<ul>
<li>Los niveles inferiores proporcionan servicios a los niveles superiores, y en cada nivel se aumenta la abstracción de las operaciones.</li>
</ul></li>
</ul>
<div class="block">
<p>Capas del servidor de archivos</p>
<ol type="1">
<li><p>Sistema de archivos virtual (+ abstracto).</p></li>
<li><p>Módulo de organización de archivos.</p></li>
<li><p>Servidor de bloques.</p></li>
<li><p>Manejadores de dispositivos (- abstracto).</p></li>
</ol>
</div>
</section>
<section id="servidor-de-archivos-2" class="level3">
<h3 class="anchored" data-anchor-id="servidor-de-archivos-2">Servidor de Archivos</h3>
<div class="center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/servidorArchivos.png" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption class="figure-caption">image</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="sistema-de-archivos-virtual" class="level2">
<h2 class="anchored" data-anchor-id="sistema-de-archivos-virtual">Sistema de archivos virtual</h2>
<section id="servidor-de-archivos-3" class="level3">
<h3 class="anchored" data-anchor-id="servidor-de-archivos-3">Servidor de Archivos</h3>
<ol type="1">
<li><p><strong>Sistema de archivos virtual</strong>:</p>
<ul>
<li><p>Proporciona la interfaz para las llamadas de E/S que deseen realizar los procesos de usuario, interactuando con el módulo de organización de archivos.</p></li>
<li><p>Cumple las funciones de manejo de directorios, gestión de nombres, servicios de seguridad, integración de archivos de distintos dispositivos/particiones...</p></li>
<li><p>Por ello, es necesario utilizar una estructura adicional (nodos virtuales o <strong>nodos-v</strong> en UNIX), que incluye las características comunes a todos los sistemas de archivos y un enlace al descriptor de archivo particular (nodo-i o registro).</p></li>
</ul></li>
</ol>
</section>
<section id="servidor-de-archivos-4" class="level3">
<h3 class="anchored" data-anchor-id="servidor-de-archivos-4">Servidor de Archivos</h3>
<ol type="1">
<li><p><strong>Sistema de archivos virtual</strong>:</p>
<ul>
<li><p>Hay operaciones genéricas que se pueden realizar en cualquier SA (caché de nombres, gestión de nodos virtuales...).</p></li>
<li><p>Otras operaciones deben ser implementadas independientemente para cada tipo de SA.</p></li>
<li><p>Los <strong>nodos virtuales</strong> contienen la siguiente información:</p>
<ul>
<li><p>Atributos del archivo.</p></li>
<li><p>Puntero al nodo-i real.</p></li>
<li><p>Punteros a funciones que realizan las operaciones genéricas de cualquier SA.</p></li>
<li><p>Punteros a funciones que realizan las operaciones propias del SA concreto.</p></li>
</ul></li>
</ul></li>
</ol>
</section>
</section>
<section id="módulo-de-organización-de-archivos" class="level2">
<h2 class="anchored" data-anchor-id="módulo-de-organización-de-archivos">Módulo de organización de archivos</h2>
<section id="servidor-de-archivos-5" class="level3">
<h3 class="anchored" data-anchor-id="servidor-de-archivos-5">Servidor de Archivos</h3>
<ol start="2" type="1">
<li><p><strong>Módulo de organización de archivos</strong>:</p>
<ul>
<li><p>Se implementa por separado para cada tipo de SA.</p></li>
<li><p>Relaciona la imagen lógica de un archivo con su imagen física, traduciendo direcciones lógicas (<span class="alert">contiguas</span>) del archivo a las direcciones físicas (normalmente <span class="alert">dispersas</span>) del dispositivo.</p></li>
<li><p>Se prestan los servicios de gestión de espacio libre y manejo de descriptores de archivos físicos (no virtuales).</p></li>
<li><p>Este nivel se basa en la información de los nodos-i y utiliza los servicios del servidor de bloques para realizar las operaciones correspondientes.</p></li>
</ul></li>
</ol>
</section>
</section>
<section id="servidor-de-bloques" class="level2">
<h2 class="anchored" data-anchor-id="servidor-de-bloques">Servidor de bloques</h2>
<section id="servidor-de-archivos-6" class="level3">
<h3 class="anchored" data-anchor-id="servidor-de-archivos-6">Servidor de Archivos</h3>
<ol start="3" type="1">
<li><p><strong>Servidor de bloques</strong>:</p>
<ul>
<li><p>Este nivel emite los mandatos genéricos para leer y escribir bloques en los manejadores de dispositivo (E/S de bloques).</p></li>
<li><p>Se traducirán en llamadas al manejador específico del SA.</p></li>
<li><p>En este nivel se realiza la caché de bloques.</p></li>
</ul></li>
</ol>
</section>
</section>
<section id="manejador-de-dispositivos" class="level2">
<h2 class="anchored" data-anchor-id="manejador-de-dispositivos">Manejador de dispositivos</h2>
<section id="servidor-de-archivos-7" class="level3">
<h3 class="anchored" data-anchor-id="servidor-de-archivos-7">Servidor de Archivos</h3>
<ol start="4" type="1">
<li><p><strong>Manejadores de dispositivos</strong>:</p>
<ul>
<li><p>Son específicos para cada <em>hardware</em>.</p></li>
<li><p>Traducen órdenes de E/S de alto nivel a un formato que pueda entender el dispositivo (dependiente del <em>hardware</em>).</p></li>
</ul></li>
</ol>
</section>
<section id="servidor-de-archivos-8" class="level3">
<h3 class="anchored" data-anchor-id="servidor-de-archivos-8">Servidor de Archivos</h3>
<div class="center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/ejemploSA.png" class="img-fluid figure-img" style="width:75.0%"></p>
<p></p><figcaption class="figure-caption">image</figcaption><p></p>
</figure>
</div>
</div>
</section>
</section>
<section id="funcionamiento-esquemático" class="level2">
<h2 class="anchored" data-anchor-id="funcionamiento-esquemático">Funcionamiento esquemático</h2>
<section id="directorios" class="level3">
<h3 class="anchored" data-anchor-id="directorios">Directorios</h3>
<ul>
<li><p>Un directorio es un fichero con un formato determinado.</p></li>
<li><p>El contenido de un directorio es una serie de entradas (<strong>registros</strong>), una por cada fichero contenido en él.</p></li>
<li><p>Cada registro tiene, al menos, el nombre del fichero y el puntero al descriptor físico correspondiente.</p></li>
</ul>
<div class="center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/directorios.png" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption class="figure-caption">image</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="directorios-1" class="level3">
<h3 class="anchored" data-anchor-id="directorios-1">Directorios</h3>
<div class="center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/interpretarNombre.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="directorios-2" class="level3">
<h3 class="anchored" data-anchor-id="directorios-2">Directorios</h3>
<ul>
<li><p>La ruta <strong><code>/users/luis/claves</code></strong> se interpreta de forma recursiva:</p>
<ol type="1">
<li><p>Traer a memoria bloque del i-nodo 2 (i-nodo raíz, conocido).</p></li>
<li><p>Se busca dentro <code>users</code> y se obtiene el i-nodo 342.</p></li>
<li><p>Traer a memoria bloque del i-nodo 342.</p></li>
<li><p>Se busca dentro <code>luis</code> y se obtiene el i-nodo 256.</p></li>
<li><p>Traer a memoria bloque del i-nodo 256.</p></li>
<li><p>Se busca dentro <code>claves</code> y se obtiene el i-nodo 758.</p></li>
<li><p>Al leer el i-nodo 758, se detecta que es un fichero y ya se tienen dónde están los datos del archivo.</p></li>
<li><p>Leer los bloques del fichero.</p></li>
</ol></li>
<li><p>¿Cuándo parar?</p>
<ul>
<li><p>No se tienen permisos.</p></li>
<li><p>Se ha encontrado el i-nodo del archivo.</p></li>
<li><p>No se encuentra el siguiente elemento de la ruta.</p></li>
</ul></li>
</ul>
</section>
<section id="directorios-3" class="level3">
<h3 class="anchored" data-anchor-id="directorios-3">Directorios</h3>
<ul>
<li><p>La llamada <code>open()</code> termina con la lectura del i-nodo.</p></li>
<li><p>La verificación de permisos se hace con los datos del i-nodo.</p></li>
<li><p>Un directorio no es un i-nodo:</p></li>
</ul>
<div class="center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/diferenciaArchivoDirectorio.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="enlaces" class="level3">
<h3 class="anchored" data-anchor-id="enlaces">Enlaces</h3>
<div class="center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/enlaces.png" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption class="figure-caption">image</figcaption><p></p>
</figure>
</div>
</div>
</section>
</section>
</section>
<section id="asignación-de-bloques" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Asignación de bloques</h1>
<section id="asignación-de-bloques-1" class="level3">
<h3 class="anchored" data-anchor-id="asignación-de-bloques-1">Asignación de bloques</h3>
<ul>
<li><p><strong>Asignación</strong>: cómo se hace la correspondencia entre los bloques físicos del disco y los bloques lógicos del archivo.</p></li>
<li><p><strong>Mecanismos de asignación</strong>:</p>
<ul>
<li><p>Asignación de <strong>bloques contiguos</strong>:</p>
<ul>
<li><p>Todos los bloques del archivo se encuentran contiguos en el disco. Muy sencillo de implementar. Accesos secuencial y directo muy rápidos. Necesario saber el tamaño del archivo al crearlo. Fragmentación del disco. Para añadir datos al archivo, puede que haya que moverlo.</p></li>
<li><p>Por todo ello, no se utiliza.</p></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="asignación-de-bloques-2" class="level3">
<h3 class="anchored" data-anchor-id="asignación-de-bloques-2">Asignación de bloques</h3>
<ul>
<li><p><strong>Mecanismos de asignación</strong>:</p>
<ul>
<li><p>Asignación de <strong>bloques no contiguos</strong>:</p>
<ul>
<li><p>Los bloques del archivo se encuentran en cualquier posición del disco. Se produce menos <span class="alert">fragmentación</span> <span class="math inline">\(\rightarrow\)</span> el primer bloque asignado es el primero que hay libre. Es necesario traducir el número de bloque lógico al número de bloque en el dispositivo.</p></li>
<li><p>Es la opción utilizada en la mayoría de SOs.</p></li>
</ul></li>
</ul></li>
<li><p>Para tener constancia de qué bloques no contiguos pertenecen a cada archivo, se utilizan <strong>listas enlazadas</strong> o <strong>índices</strong> (que pueden ser multinivel).</p>
<ul>
<li><p>ISO9660: Inicio y tamaño (fichero contiguo).</p></li>
<li><p>SF MS-DOS: FAT (fichero enlazado).</p></li>
<li><p>SF UNIX: i-nodo (fichero indexado).</p></li>
<li><p>NTFS: Registro Windows (fichero indexado).</p></li>
</ul></li>
</ul>
</section>
<section id="lista-enlazada" class="level2">
<h2 class="anchored" data-anchor-id="lista-enlazada">Lista enlazada</h2>
<section id="asignación-de-bloques-3" class="level3">
<h3 class="anchored" data-anchor-id="asignación-de-bloques-3">Asignación de bloques</h3>
<div class="exampleblock">
<p>Lista enlazada</p>
<ul>
<li><p>Cada bloque tiene un apuntador al siguiente bloque que seguiría en el archivo.</p></li>
<li><p>El descriptor del archivo solo debe incluir la referencia al primer bloque. El acceso secuencial es muy rápido. El acceso aleatorio a un bloque concreto de un archivo es muy costoso. Cada bloque incluye un apuntador que aumenta su tamaño (y complica el cálculo de espacio libre). La pérdida de un bloque supone perder el archivo completo.</p></li>
</ul>
</div>
</section>
</section>
<section id="tabla-de-asignación-de-archivos-fat" class="level2">
<h2 class="anchored" data-anchor-id="tabla-de-asignación-de-archivos-fat">Tabla de asignación de archivos (FAT)</h2>
<section id="asignación-de-bloques-4" class="level3">
<h3 class="anchored" data-anchor-id="asignación-de-bloques-4">Asignación de bloques</h3>
<div class="exampleblock">
<p>Tabla de asignación de archivos</p>
<ul>
<li><p>Es una variación del <strong>método lista enlazada</strong>.</p></li>
<li><p>Los apuntadores se almacenan en una tabla independiente de los bloques (<em>File Allocation Table</em>, FAT).</p></li>
<li><p>La tabla posee una entrada por cada bloque del SA.</p></li>
<li><p>La FAT ocupará un espacio prefijado en la partición.</p></li>
<li><p>Descriptor fichero <span class="math inline">\(\rightarrow\)</span> incluye su primera posición en la tabla.</p></li>
<li><p>Acceso aleatorio al archivo: recorriendo la tabla.</p></li>
<li><p>La tabla se aloja en caché para mejorar las prestaciones y se mantiene una copia doble en el disco para mayor fiabilidad. ¡La FAT puede llegar a ocupar mucho! <span class="math inline">\(\rightarrow\)</span> agrupaciones.</p></li>
</ul>
</div>
</section>
<section id="asignación-de-bloques-5" class="level3">
<h3 class="anchored" data-anchor-id="asignación-de-bloques-5">Asignación de bloques</h3>
<div class="center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/fat.jpg" style="height:6.2cm" class="figure-img"></p>
<p></p><figcaption class="figure-caption">image</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="asignación-de-bloques-6" class="level3">
<h3 class="anchored" data-anchor-id="asignación-de-bloques-6">Asignación de bloques</h3>
<div class="columns">
<div class="column">
<p>0.4</p>
<ul>
<li><p>FAT de 12 bits: 4K agrupaciones.</p></li>
<li><p>FAT de 16 bits: 64K agrupaciones.</p></li>
<li><p>FAT de 32 bits: <span class="math inline">\(2^{28}\)</span> agrupaciones (solo usa 28 bits). Tamaño de fichero en directorios <span class="math inline">\(\rightarrow\)</span> 32 bits. Tamaño máximo <span class="math inline">\(\rightarrow 2^{32} -1 = 4GB -1\)</span></p></li>
</ul>
</div><div class="column">
<p>0.7 <img src="images/fat2.png" class="img-fluid" style="width:70.0%" alt="image"></p>
</div>
</div>
</section>
</section>
<section id="índices-e-índices-multinivel" class="level2">
<h2 class="anchored" data-anchor-id="índices-e-índices-multinivel">Índices e índices multinivel</h2>
<section id="asignación-de-bloques-7" class="level3">
<h3 class="anchored" data-anchor-id="asignación-de-bloques-7">Asignación de bloques</h3>
<div class="exampleblock">
<p>Índices</p>
<ul>
<li><p>Los punteros a los bloques están juntos y contiguos en una localización concreta <span class="math inline">\(\rightarrow\)</span> <strong>Bloques índice</strong>.</p></li>
<li><p>Cada archivo tiene un bloque índice.</p></li>
<li><p>Para buscar el <strong><span class="math inline">\(i\)</span>-ésimo</strong> bloque de un fichero, buscamos la <strong><span class="math inline">\(i\)</span>-ésima</strong> entrada en su bloque índice Buen acceso directo. Se evita la fragmentación. ¿Tamaño del bloque índice? <span class="math inline">\(\rightarrow\)</span> debe fijarse un número de entradas y hay que reservar espacio para todas ellas. Limitamos el tamaño máximo de los archivos.</p></li>
</ul>
</div>
</section>
<section id="asignación-de-bloques-8" class="level3">
<h3 class="anchored" data-anchor-id="asignación-de-bloques-8">Asignación de bloques</h3>
<div class="exampleblock">
<p>Índice multinivel</p>
<ul>
<li><p>Consiste en introducir <span class="math inline">\(n\)</span> <strong>niveles de apuntadores</strong>, de manera que los apuntadores del descriptor apuntan a otros.</p></li>
<li><p>Índice multinivel de nivel 1: el bloque índice apunta a otros bloques índices que finalmente apunta a un bloque de datos del fichero. Evita tener que prefijar el tamaño del bloque índice (podemos poner apuntadores a NULL). El bloque índice tendrá un número pequeño de entradas. Cada nivel, supone un acceso a disco adicional. Para archivos pequeños, se desaprovechan muchos bloques índice.</p></li>
</ul>
</div>
</section>
<section id="asignación-de-bloques-9" class="level3">
<h3 class="anchored" data-anchor-id="asignación-de-bloques-9">Asignación de bloques</h3>
<div class="exampleblock">
<p>Solución UNIX <span class="math inline">\(\rightarrow\)</span> Esquema híbrido</p>
<ul>
<li><p>Por cada nodo-i incluir 15 punteros:</p>
<ul>
<li><p>Punteros directos a los 12 primeros bloques (para archivos pequeños). Nota: la siguiente figura indica 10 erróneamente.</p></li>
<li><p>Puntero a un bloque índice de primer nivel (donde encontraremos punteros a bloques).</p></li>
<li><p>Puntero a un bloque índice de segundo nivel (donde encontraremos punteros a punteros a bloques).</p></li>
<li><p>Puntero a un bloque índice de tercer nivel (donde encontraremos punteros a punteros a punteros a bloques).</p></li>
</ul></li>
<li><p>Bloques del disco: bloques de datos o bloques índice.</p></li>
<li><p>En ext4 y en NTFS existen los extents (bloques índice especiales que marcan una zona contigua del disco “numeroBloqueInicial, numeroBloques”).</p></li>
</ul>
</div>
</section>
<section id="asignación-de-bloques-indexado-multinivel" class="level3">
<h3 class="anchored" data-anchor-id="asignación-de-bloques-indexado-multinivel">Asignación de bloques: indexado multinivel</h3>
<div class="center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/indexadoMultinivel.jpg" class="img-fluid figure-img" style="width:60.0%"></p>
<p></p><figcaption class="figure-caption">image</figcaption><p></p>
</figure>
</div>
</div>
</section>
</section>
</section>
<section id="gestión-del-espacio-libre" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Gestión del espacio libre</h1>
<section id="gestión-del-espacio-libre-1" class="level3">
<h3 class="anchored" data-anchor-id="gestión-del-espacio-libre-1">Gestión del espacio libre</h3>
<ul>
<li><p><strong>Gestión del espacio libre</strong>: se necesita para asignar espacio a los archivos nuevos o a los que se les desea añadir datos.</p></li>
<li><p>Se mantienen <strong>mapas de recursos</strong>, implementados como mapas de bits o listas de recursos libres.</p>
<ul>
<li><p><strong>Mapas de bits</strong></p>
<ul>
<li><p>Se incluye un bit por recurso (descriptor de archivo, bloque o agrupación), que será 1 si el recurso esta libre y 0 en caso contrario. Muy sencillo de implementar y de usar. Disco poco fragmentado <span class="math inline">\(\rightarrow\)</span> bloques libres al final, búsqueda muy eficiente. Disco fragmentado <span class="math inline">\(\rightarrow\)</span> búsqueda más costosa. Espacio adicional requerido por el mapa.</p></li>
<li><p>FAT: la propia tabla actúa como mapa de recursos.</p></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="gestión-del-espacio-libre-2" class="level3">
<h3 class="anchored" data-anchor-id="gestión-del-espacio-libre-2">Gestión del espacio libre</h3>
<ul>
<li><p><strong>Gestión del espacio libre</strong>.</p>
<ul>
<li><p><strong>Listas de recursos libres</strong></p>
<ul>
<li><p>Mantener una lista de apuntadores a los recursos libres.</p></li>
<li><p>Al ocupar un recurso lo borramos de la lista. Muy eficiente para discos muy llenos y fragmentados. Disco con mucho espacio libre <span class="math inline">\(\rightarrow\)</span> Ineficiente debido a que hay que cargar la lista.</p></li>
<li><p>Solución <span class="math inline">\(\rightarrow\)</span> Incluir número de bloques libres consecutivos en la lista.</p></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="gestión-del-espacio-libre-fat-lista-enlazada" class="level3">
<h3 class="anchored" data-anchor-id="gestión-del-espacio-libre-fat-lista-enlazada">Gestión del espacio libre: FAT + lista enlazada</h3>
<div class="center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/espacioLibre.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">image</figcaption><p></p>
</figure>
</div>
</div>
</section>
</section>
<section id="incremento-de-prestaciones" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Incremento de prestaciones</h1>
<section id="incremento-de-prestaciones-1" class="level3">
<h3 class="anchored" data-anchor-id="incremento-de-prestaciones-1">Incremento de prestaciones</h3>
<ul>
<li><p>Acceso a <strong>memoria</strong> <span class="math inline">\(\rightarrow\)</span> orden de nanosegundos.</p></li>
<li><p>Acceso a <strong>disco</strong> <span class="math inline">\(\rightarrow\)</span> orden de milisegundos.</p>
<ul>
<li><p><strong>Almacenamiento intermedio de los datos</strong></p>
<ul>
<li><p>Mantener una caché de datos en Memoria Principal (MP).</p></li>
<li><p>Aprovecha la proximidad <span class="alert">espacial</span> y <span class="alert">temporal</span> en las referencias a los datos accedidos.</p></li>
<li><p><strong>Caché de nombres</strong>: lista con <code>{nombre,nodo-i}</code>. Si se vuelve a acceder al archivo, no hay que hacer toda la búsqueda del <code>nodo-i</code>.</p></li>
<li><p><strong>Caché de bloques</strong>: colección de bloques leídos o escritos recientemente. Si se vuelve a acceder a ese bloque, no hay que cargarlo de nuevo.</p></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="incremento-de-prestaciones-2" class="level3">
<h3 class="anchored" data-anchor-id="incremento-de-prestaciones-2">Incremento de prestaciones</h3>
<ul>
<li><p><strong>Caché de bloques</strong>:</p>
<ul>
<li><p>Si el bloque está en MP, se escribirá o leerá en MP.</p></li>
<li><p>Posteriormente, se moverán los bloques de MP al dispositivo.</p></li>
<li><p>Si la caché está llena, hay que eliminar algún bloque:</p>
<ul>
<li><p><strong>Políticas de reemplazo</strong>: <em>First In First Out</em> (FIFO), <em>Most Recently Used</em> (MRU), <em>Least Recently Used</em> (LRU)...</p></li>
<li><p>Lo más común es <strong>LRU</strong>: aprovecha que los bloques no utilizados durante mucho tiempo, posiblemente no volverán a ser utilizados. Peligroso si hay un fallo del SA.</p></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="incremento-de-prestaciones-3" class="level3">
<h3 class="anchored" data-anchor-id="incremento-de-prestaciones-3">Incremento de prestaciones</h3>
<ul>
<li><p><strong>Caché de bloques</strong>:</p>
<ul>
<li><p>Bloques sucios (cambiados en caché pero no en el disco). Distintas políticas a la hora de mantener la <span class="alert">coherencia</span>:</p>
<ul>
<li><p><strong>Escritura inmediata</strong> (<em>write-through</em>) <span class="math inline">\(\rightarrow\)</span> Siempre actualizado.</p></li>
<li><p><strong>Escritura diferida</strong> (<em>write-back</em>) <span class="math inline">\(\rightarrow\)</span> Actualizamos cuando el bloque salga de la caché.</p></li>
<li><p><strong>Escritura periódica</strong> (<em>delayed-write</em>) <span class="math inline">\(\rightarrow\)</span> Establecer un tiempo periódico para las actualizaciones. Compromiso entre rendimiento y fiabilidad. Reduce la extensión de los posibles daños por caídas.</p></li>
</ul></li>
<li><p>Se puede distinguir entre bloques <strong>especiales</strong> (directorios, nodos-i o bloques índice) y bloques de <strong>datos</strong>. Bloques especiales <span class="math inline">\(\rightarrow\)</span> <em>write-through</em>.</p></li>
<li><p>No se debe quitar un disco del sistema sin antes volcar los datos de la cache (comando <strong><code>sync</code></strong>).</p></li>
</ul></li>
</ul>
</section>
</section>
<section id="referencias" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Referencias</h1>
<section id="referencias-1" class="level3">
<h3 class="anchored" data-anchor-id="referencias-1">Referencias</h3>
<div class="thebibliography">
<p>Fernando Pérez-Costoya, Jesús Carretero-Pérez y Félix García-Carballeira. Problemas de Sistemas Operativos. De la base al diseño. Tema 8. Archivos y directorios. Sección 8.4. Sistemas de Archivos. Mc Graw Hill, Segunda Edición, 2003.</p>
<p>Evi Nemeth, Garth Snyder, Trent R. Hein y Ben Whaley Unix and Linux system administration handbook. Capítulo 8. <em>Storage and disk</em>. Prentice Hall. Cuarta edición. 2010.</p>
</div>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Notas</h2>

<ol>
<li id="fn1"><p><a href="https://whereismydata.wordpress.com/2008/08/23/file-systems-mbr-and-volume-boot-record-basic/" class="uri">https://whereismydata.wordpress.com/2008/08/23/file-systems-mbr-and-volume-boot-record-basic/</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>